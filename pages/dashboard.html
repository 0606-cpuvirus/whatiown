<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What I Own - Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">

    <!-- Appwrite SDK -->
    <script src="https://cdn.jsdelivr.net/npm/appwrite@14.0.1"></script>
    <script src="../js/app.js"></script>
</head>

<body>

    <nav class="navbar">
        <div class="logo">
            <h3>What I Own</h3>
        </div>
        <div class="nav-links">
            <a href="dashboard.html" class="active">Dashboard</a>
            <a href="wardrobe.html">Wardrobe</a>
            <a href="add-item.html">Add Item</a>
            <a href="generate-outfit.html">Generate</a>
            <a href="profile-settings.html">Profile</a>
            <a href="#" id="logout-btn">Logout</a>
        </div>
    </nav>

    <div class="container">
        <h1>Welcome, <span id="user-name">...</span></h1>

        <div class="grid">
            <!-- Quick Actions -->
            <div class="card" onclick="window.location.href='wardrobe.html'" style="cursor: pointer;">
                <h3>My Wardrobe</h3>
                <p>Total Items: <span id="total-items">Loading...</span></p>
            </div>

            <div class="card" onclick="window.location.href='add-item.html'" style="cursor: pointer;">
                <h3>Add New Item</h3>
                <p>Digitize your closet</p>
            </div>

            <div class="card" onclick="window.location.href='generate-outfit.html'" style="cursor: pointer;">
                <h3>Generate Outfit</h3>
                <p>AI or Standard styling</p>
            </div>

            <div class="card" onclick="window.location.href='outfit-history.html'" style="cursor: pointer;">
                <h3>History</h3>
                <p>View past looks</p>
            </div>

            <div class="card" onclick="window.location.href='statistics.html'" style="cursor: pointer;">
                <h3>Statistics</h3>
                <p>Wardrobe insights</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const userNameSpan = document.getElementById('user-name');
            const totalItemsSpan = document.getElementById('total-items');
            const logoutBtn = document.getElementById('logout-btn');

            // Initialize Appwrite
            const checkAppwrite = setInterval(async () => {
                if (window.appwriteService) {
                    clearInterval(checkAppwrite);

                    try {
                        const user = await window.appwriteService.getCurrentUser();
                        if (!user) {
                            window.location.href = '../index.html';
                            return;
                        }
                        userNameSpan.innerText = user.name;

                        // Fetch Stats
                        const items = await window.appwriteService.listWardrobeItems(user.$id, { limit: 1 });
                        totalItemsSpan.innerText = items.total;

                    } catch (error) {
                        console.error("Dashboard error:", error);
                        // window.location.href = '../index.html';
                    }
                }
            }, 100);

            // Logout
            logoutBtn.addEventListener('click', async (e) => {
                e.preventDefault();
                await window.appwriteService.logout();
                window.location.href = '../index.html';
            });
        });
    </script>
</body>

</html>